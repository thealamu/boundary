---
layout: docs
page_title: Manage SSH via Boundary 
sidebar_title: Manage SSH
description: How to manage SSH proxy configuration with Boundary
---

# Manage SSH via Boundary 

The most common pattern for using Boundary to SSH is with the built-in `boundary connect ssh` command. However,
there are more idomatic approaches that can be employed to make Boundary transparent to users, and at the same
time simplify common developer and operator workflows. Using `ProxyCommand` to execute a proxy when envoking the
SSH client is a common practice. In this workflow, we'll cover configuring your SSH client to execute the 
`boundary` command, enabling a simplified SSH workflow that leverages Boundary's authenticated proxy for accessing
targets.

## SSH Configuration

Start by configuring a `Host` entry in `.ssh/ssh_config` for `localhost`:

```bash
Host localhost
    SendEnv LANG LC_*
    PasswordAuthentication yes

    # requires BOUNDARY_CONNECT_AUTHZ_TOKEN to be set from authorize-session command
    ProxyCommand sh -c "boundary connect -exec nc -- {{boundary.ip}} {{boundary.port}}"
```

The `ProxyCommand` tells the SSH client to envoke `boundary connect`. We are passing the `-exec nc` flag to 
`boundary connect` to wrap [netcat](http://netcat.sourceforge.net/), and then pass the `boundary.ip` and `boundary.port`
varibles as arguments to `nc`. This allows us to proxy our SSH connection through a local netcat tunnel that's
managed as a Boundary session.

Now, when you run `ssh <user>@localhost`, SSH will envoke `boundary connect`, and will tunnel the traffic through 
the local Boundary proxy in a wrapped netcat session.

## Authenticate to Boundary

Before you can envoke `boundary connect` you need to authenticate. In this example, we're using `boundary dev` with the 
default username (admin) and password (password):

```bash
$ boundary authenticate password -login-name=admin -password password -auth-method-id=ampw_1234567890
```

## Authorize the Session

Running Boundary in [dev mode](https://www.boundaryproject.io/docs/getting-started#what-is-dev-mode) creates other 
default resources such as a target and auth method. The default target (ttcp_1234567890) is already setup with a host
at `localhost` and a default port of `22`. 

Authorize a session to the default target and store the token in the `BOUNDARY_CONNECT_AUTHZ_TOKEN` environment variable. 
This will be used by Boundary when it's envoked by SSH:

```bash
$ export BOUNDARY_CONNECT_AUTHZ_TOKEN=$(boundary targets authorize-session -id ttcp_1234567890 -format json | jq '.authorization_token' | tr -d '"')
```

## SSH 

With the token now set in your environment variable, you can simply run `ssh` as you normally would and all the traffic
will be proxied over the localhost Boundary proxy to your target machine:

```bash
$ ssh jeffmalnick@localhost
Password:
Last login: Thu Nov 19 10:32:09 2020
âžœ  ~
```

On the controller, you should see the session being invoked in the logs:

```bash
controller.worker-handler: connection established: session_id=s_WkaQbqmrJx connection_id=sc_RDYNFFI2M4 client_tcp_address=127.0.0.1 client_tcp_port=57421 endpoint_tcp_address=::1 endpoint_tcp_port=22
```
